<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        video {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: -100;
        }

        body, ul {
            color: #fff;
            background-color: #888;
            padding: 0;
            margin: 0;
        }

        li {
            list-style: none;
            padding: 0;
            margin: 10px;
        }

        span {
            font-size: 1em;
        }
    </style>
    <script src="js/jquery.min.js"></script>
    <script src="js/flint_receiver_sdk.js"></script>
</head>
<body>
<ul class="logList"></ul>
<video id="video" autoplay></video>
<script>

    function log(message) {
        $('.logList').append('<li>' + message + '</li>')
    }

    function randomToken() {
        return Math.random().toString(36).substr(2);
    }

    try {
        var manager = new FlintReceiverManager({
            appId: '~a3ad1b9e-6883-11e4-b116-123b93f75cba'
        });

        manager.on('ready', function () {

            log('FlintReceiverManager is ready !');

            var channelName = randomToken();

            var ws = new WebSocket('ws://127.0.0.1:9439/channels/' + channelName);

            ws.onopen = function () {
                log('Websocket is opend');

                manager.setAdditionalData('channelName', channelName);
            };

            ws.onerror = function (error) {
                log('Websocket cause error ' + JSON.stringify(error));
            };

            ws.onmessage = function (data) {

                // var msg = JSON.parse(data);

                log('Websocket message : ' + typeof(data));

//
//                if (msg.type === 'senderConnected') {
//                    // Handle new sender connected event
//                    log('Sender connected : ' + msg.senderId);
//
//                } else if (msg.type === 'senderDisconnected') {
//                    // Handle sender lost event
//                    log('Sender disconnected : ' + msg.senderId);
//
//                } else if (msg.type === 'message') {
//                    // Handle other message
//
//                    log('Sender message : ' + msg.data);
//
//                    ws.send(JSON.stringify({
//                        senderId: msg.senderId,
//                        data: 'Reply : ' + msg.data
//                    }));
//                }
            };
        });

        manager.start();

        log('FlintReceiverManager is started !');

    } catch (e) {
        log(e.toString());
    }

    // var channel = manager.createWebsocketChannel();

    // var peer = manager.createPeer();
    //
    // peer.on('open', function (id) {
    //
    //     console.log("Peer Id = " + id);
    //
    //     peer.on('connection', function (conn) {
    //
    //         // Receive messages
    //         conn.on('data', function (data) {
    //             console.log('Received', data);
    //             // Send messages
    //             conn.send('Reply : ' + data);
    //         });
    //     });
    //
    //     peer.on('call', function (call) {
    //         console.log("Answer the call, providing our mediaStream");
    //         call.answer();
    //         call.on('stream', function (stream) {
    //             // `stream` is the MediaStream of the remote peer.
    //             // Here you'd add it to an HTML video/canvas element.
    //             var video = document.getElementById('video');
    //             video.src = window.URL.createObjectURL(stream);
    //         });
    //     });
    // });

</script>
</body>
</html>