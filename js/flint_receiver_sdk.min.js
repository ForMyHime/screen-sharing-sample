/*! screen-sharing-sample build:0.1.0, production. Copyright(C) 2013-2014 www.OpenFlint.org */!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};d=function(){function a(){}return a.CONNECTING=0,a.OPEN=1,a.CLOSING=2,a.CLOSED=3,a}(),c=function(a){function b(a){this.appId=a.appId,this.wsconn=null,this.wsServer="ws://127.0.0.1:9431/receiver/"+this.appId}return f(b,a),b.prototype.start=function(a){var b,c;if((null!=(b=this.wsconn)?b.readyState:void 0)!==d.CONNECTING&&(null!=(c=this.wsconn)?c.readyState:void 0)!==d.OPEN)return this.additionalData=a,this.wsconn=new WebSocket(this.wsServer),this.wsconn.onopen=function(a){return function(b){return a._onOpen(b)}}(this),this.wsconn.onclose=function(){return function(){return console.info("----------------------------------------------->flingd onclose....")}}(this),this.wsconn.onmessage=function(a){return function(b){return console.info("----------------------------------------------->flingd onmessage....",b.data),b.data?a._onMessage(JSON.parse(b.data)):void 0}}(this),this.wsconn.onerror=function(a){return function(b){return console.info("----------------------------------------------->flingd onerror....",b),a._onError({message:"Underlying websocket is not open",socketReadyState:b.target.readyState})}}(this)},b.prototype.setAdditionalData=function(a){return this.additionalData=a,this.send({type:"additionaldata",additionaldata:this.additionalData})},b.prototype.send=function(a){var b,c;return a.appid=this.appId,a=JSON.stringify(a),console.info("----------------------------------------------->flingd send....",a),(null!=(b=this.wsconn)?b.readyState:void 0)===d.OPEN?this.wsconn.send(a):(null!=(c=this.ws)?c.readyState:void 0)===d.CONNECTING?setTimeout(function(b){return function(){return b.send(a)}}(this),50):this._onError({message:"Underlying websocket is not open",socketReadyState:d.CLOSED})},b.prototype._onError=function(a){return this.emit("error",a)},b.prototype._onOpen=function(){return this.send({type:"register"})},b.prototype._onSenderConnected=function(){},b.prototype._onSenderDisconnected=function(){},b.prototype._onMessage=function(a){switch(console.error("_onMessage",a),null!=a?a.type:void 0){case"startheartbeat":return console.log("startheartbeat");case"registerok":return this.localIpAddress=a.service_info.ip[0],this.uuid=a.service_info.uuid,this.deviceName=a.service_info.device_name,console.info("=========================================>flingd has onopened: ",g.call(self,"onopend")>=0),this.send({type:"additionaldata",additionaldata:this.additionalData}),this.emit("ready");case"heartbeat":return this.send("ping"===a.heartbeat?{type:"heartbeat",heartbeat:"pong"}:{type:"heartbeat",heartbeat:"ping"});case"senderconnected":return this._onSenderConnected(a);case"senderdisconnected":return this._onSenderDisconnected(a);default:return this.emit("message",a)}},b}(EventEmitter),b.exports=c},{}],2:[function(a){window.FlintReceiverManager=a("./FlintReceiverManager")},{"./FlintReceiverManager":1}]},{},[2]);