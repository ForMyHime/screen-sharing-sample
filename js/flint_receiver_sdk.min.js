/*! screen-sharing-sample build:0.1.0, production. Copyright(C) 2013-2014 www.OpenFlint.org */(function(){var a,b,c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=function(a,b){var c,d,e;if(a.length>0)for(c=d=0,e=a.length-1;e>=0?e>=d:d>=e;c=e>=0?++d:--d)if(a[c].listener===b)return c;return-1},d=function(a){return function(){return this[a].apply(this,arguments)}},a=function(){function a(){}return a.prototype.getListeners=function(a){var b,c,d;if(b=this._getEvents(),a instanceof RegExp){d={};for(c in b)b.hasOwnProperty(c)&&a.test(c)&&(d[c]=b[c])}else d=b[a]||(b[a]=[]);return d},a.prototype.flattenListeners=function(a){var b,c;for(b=[],c=0;c<a.length;)b.push(a[c].listener),c+=1;return b},a.prototype.getListenersAsObject=function(a){var b,c;return b=this.getListeners(a),c=void 0,b instanceof Array&&(c={},c[a]=b),c||b},a.prototype.addListener=function(a,b){var c,d,f;f=this.getListenersAsObject(a),d="object"==typeof b;for(c in f)f.hasOwnProperty(c)&&-1===e(f[c],b)&&f[c].push(d?b:{listener:b,once:!1});return this},a.prototype.on=d("addListener"),a.prototype.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},a.prototype.once=d("addOnceListener"),a.prototype.defineEvent=function(a){return this.getListeners(a),this},a.prototype.defineEvents=function(a){var b;for(b=0;b<a.length;)this.defineEvent(a[b]),b+=1;return this},a.prototype.removeListener=function(a,b){var c,d,f;f=this.getListenersAsObject(a);for(d in f)f.hasOwnProperty(d)&&(c=e(f[d],b),-1!==c&&f[d].splice(c,1));return this},a.prototype.off=d("removeListener"),a.prototype.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},a.prototype.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},a.prototype.manipulateListeners=function(a,b,c){var d,e,f,g;if(g=void 0,f=a?this.removeListener:this.addListener,e=a?this.removeListeners:this.addListeners,"object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(g=b[d])&&("function"==typeof g?f.call(this,d,g):e.call(this,d,g));return this},a.prototype.removeEvent=function(a){var b,c,d;if(d=typeof a,b=this._getEvents(),"string"===d)delete b[a];else if(a instanceof RegExp)for(c in b)b.hasOwnProperty(c)&&a.test(c)&&delete b[c];else delete this._events;return this},a.prototype.removeAllListeners=d("removeEvent"),a.prototype.emitEvent=function(a,b){var c,d,e,f,g;f=this.getListenersAsObject(a);for(d in f)if(f.hasOwnProperty(d))for(c=f[d].length;c--;)e=f[d][c],e.once===!0&&this.removeListener(a,e.listener),g=e.listener.apply(this,b||[]),g===this._getOnceReturnValue()&&this.removeListener(a,e.listener);return this},a.prototype.trigger=d("emitEvent"),a.prototype.emit=function(a){var b;return b=Array.prototype.slice.call(arguments,1),this.emitEvent(a,b)},a.prototype.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},a.prototype._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},a.prototype._getEvents=function(){return this._events||(this._events={})},a}(),c=function(){function a(){}return a.CONNECTING=0,a.OPEN=1,a.CLOSING=2,a.CLOSED=3,a}(),b=function(a){function b(a){this.appId=a,this.wsconn=null,this.wsServer="ws://localhost:9431/receiver/"+this.appId}return g(b,a),b.prototype.start=function(a){var b,d;if((null!=(b=this.wsconn)?b.readyState:void 0)!==c.CONNECTING&&(null!=(d=this.wsconn)?d.readyState:void 0)!==c.OPEN)return this.additionalData=a,this.wsconn=new WebSocket(this.wsServer),this.wsconn.onopen=function(a){return function(b){return a._onOpen(b)}}(this),this.wsconn.onclose=function(){return function(){return console.info("----------------------------------------------->flingd onclose....")}}(this),this.wsconn.onmessage=function(a){return function(b){return console.info("----------------------------------------------->flingd onmessage....",b.data),b.data?a._onMessage(JSON.parse(b.data)):void 0}}(this),this.wsconn.onerror=function(a){return function(b){return console.info("----------------------------------------------->flingd onerror....",b),a._onError({message:"Underlying websocket is not open",socketReadyState:b.target.readyState})}}(this)},b.prototype.setAdditionalData=function(a){return this.additionalData=a,this.send({type:"additionaldata",additionaldata:this.additionalData})},b.prototype.send=function(a){var b,d;return a.appid=this.appId,a=JSON.stringify(a),console.info("----------------------------------------------->flingd send....",a),(null!=(b=this.wsconn)?b.readyState:void 0)===c.OPEN?this.wsconn.send(a):(null!=(d=this.ws)?d.readyState:void 0)===c.CONNECTING?setTimeout(function(b){return function(){return b.send(a)}}(this),50):this._onError({message:"Underlying websocket is not open",socketReadyState:c.CLOSED})},b.prototype._onError=function(a){return this.emit("error",a)},b.prototype._onOpen=function(){return this.send({type:"register"})},b.prototype._onSenderConnected=function(){},b.prototype._onSenderDisconnected=function(){},b.prototype._onMessage=function(a){switch(console.error("_onMessage",a),null!=a?a.type:void 0){case"startheartbeat":return console.log("startheartbeat");case"registerok":return this.localIpAddress=a.service_info.ip[0],this.uuid=a.service_info.uuid,this.deviceName=a.service_info.device_name,console.info("=========================================>flingd has onopened: ",h.call(self,"onopend")>=0),this.send({type:"additionaldata",additionaldata:this.additionalData}),this.emit("ready");case"heartbeat":return this.send("ping"===a.heartbeat?{type:"heartbeat",heartbeat:"pong"}:{type:"heartbeat",heartbeat:"ping"});case"senderconnected":return this._onSenderConnected(a);case"senderdisconnected":return this._onSenderDisconnected(a);default:return this.emit("message",a)}},b}(a),this.FlintReceiverManager=b}).call(this);